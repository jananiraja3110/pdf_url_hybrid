<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Hybrid Deep Learning Malware Predictor</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
body { background: linear-gradient(to right, #0f2027, #203a43, #2c5364); color: #fff; font-family: 'Segoe UI', sans-serif; }
h2 { text-align:center; color: #ffc107; text-shadow: 2px 2px #000; margin-bottom:30px; }
.card { border-radius: 15px; margin-bottom: 20px; box-shadow: 3px 3px 15px rgba(0,0,0,0.5); transition: transform 0.3s; }
.card:hover { transform: scale(1.05); }
.stat-card { text-align: center; padding: 25px; border-radius: 15px; font-size: 1.5rem; }
.benign-card { background: linear-gradient(145deg,#28a745,#85e085); }
.malicious-card { background: linear-gradient(145deg,#dc3545,#f28b8b); }
.icon { width:30px; margin-right:10px; vertical-align:middle; }
canvas { background-color: #fff; border-radius: 15px; padding:10px; }
.download-btn { background:#ffc107; color:#000; border-radius:25px; padding:12px 20px; font-weight:bold; display:inline-block; margin-top:10px; text-decoration:none; }
.download-btn:hover { background:#e6b800; }
input.form-control { border-radius:10px; }
.benign { background-color:#d4f8d4; color:#000; }
.malicious { background-color:#f8d4d4; color:#000; }
.error { background-color:#ccc; color:#000; }
.feature-hint { font-size:0.9rem; color:#ffc; margin-bottom:10px; }
</style>
</head>
<body>

<div class="container my-4">
<h2>Hybrid Deep Learning Malware Predictor</h2>

{% if result %}
<div class="row mb-4">
<div class="col-md-6">
<div class="stat-card benign-card">
<h4><img src="{{ url_for('static', filename='icons/pdf_icon.png') }}" class="icon">Total Benign</h4>
<h2 id="benignCounter">0</h2>
</div>
</div>
<div class="col-md-6">
<div class="stat-card malicious-card">
<h4><img src="{{ url_for('static', filename='icons/url_icon.png') }}" class="icon">Total Malicious</h4>
<h2 id="maliciousCounter">0</h2>
</div>
</div>
</div>
{% endif %}

<div class="row">
<div class="col-md-6">
<div class="card p-4">
<h5><img src="{{ url_for('static', filename='icons/pdf_icon.png') }}" class="icon">Predict Single Sample</h5>

<div class="feature-hint">
PDF features: {{ pdf_expected_len }} values | URL features: {{ url_expected_len }} values<br>
Leave missing values blank (will auto-fill with 0)
</div>

<form action="/" method="post">
<div class="mb-3">
<label>PDF Features (comma-separated)</label>
<input type="text" class="form-control" name="pdf_features" placeholder="0.1,0.2,...">
</div>
<div class="mb-3">
<label>URL Features (comma-separated)</label>
<input type="text" class="form-control" name="url_features" placeholder="0.1,0.2,...">
</div>
<button type="submit" class="btn btn-warning w-100">Predict Single Sample</button>
</form>
</div>
</div>

<div class="col-md-6">
<div class="card p-4">
<h5><img src="{{ url_for('static', filename='icons/url_icon.png') }}" class="icon">Batch CSV Prediction</h5>
<form action="/" method="post" enctype="multipart/form-data">
<div class="mb-3">
<label>PDF CSV File</label>
<input type="file" class="form-control" name="pdf_file" required>
</div>
<div class="mb-3">
<label>URL CSV File</label>
<input type="file" class="form-control" name="url_file" required>
</div>
<button type="submit" class="btn btn-info w-100">Predict CSV</button>
</form>
</div>
</div>
</div>

{% if result %}
<div class="card p-4 mt-4">
<h5>Prediction Results</h5>
<div class="table-responsive mb-3">
<table class="table table-bordered table-hover text-dark">
<thead><tr><th>Index</th><th>Prediction</th></tr></thead>
<tbody>
{% for idx, pred in result.items() %}
<tr class="{% if pred=='Benign' %}benign{% elif pred=='Malicious' %}malicious{% else %}error{% endif %}">
<td>{{ idx }}</td>
<td>{{ pred }}</td>
</tr>
{% endfor %}
</tbody>
</table>
</div>

{% if download_available %}
<a href="/download" class="download-btn">⬇️ Download CSV Results</a>
{% endif %}

<div class="row mt-4">
<div class="col-md-6 mx-auto">
<canvas id="pieChart"></canvas>
</div>
</div>
</div>

<script>
let validResults = [];
{% for val in result.values() %}
{% if val=='Benign' or val=='Malicious' %}
validResults.push("{{ val }}");
{% endif %}
{% endfor %}

let benignCount = validResults.filter(v => v === "Benign").length;
let maliciousCount = validResults.filter(v => v === "Malicious").length;

function animateCounter(id, end){
let el = document.getElementById(id), start = 0;
let step = Math.max(Math.ceil(end / 100),1);
let interval = setInterval(()=>{
start += step;
if(start >= end){ el.innerText = end; clearInterval(interval); }
else el.innerText = start;
},10);
}

animateCounter('benignCounter', benignCount);
animateCounter('maliciousCounter', maliciousCount);

const ctx = document.getElementById('pieChart').getContext('2d');
new Chart(ctx, {
type: 'pie',
data: {
labels: ['Benign','Malicious'],
datasets:[{
data:[benignCount, maliciousCount],
backgroundColor:['#28a745','#dc3545']
}]
},
options:{
responsive:true,
plugins:{legend:{position:'bottom'}},
rotation: Math.PI,
circumference: Math.PI
}
});
</script>
{% endif %}

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
